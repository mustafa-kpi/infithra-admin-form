<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Control</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <!-- Bootstrap-Select CSS -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css">
    <!-- Include Bootstrap JavaScript -->

    <link rel="stylesheet" href="/assets/style.css">

    <style>
        hr{
            margin: 0 !important;
        }
        .hidden {
            display: none;
        }

        .loading {
            pointer-events: none;
            opacity: 0.6;
        }

        .btn-loader {
            align-items: center;
            display: flex;
            gap: 1rem;
        }

        .dropdown-item.selected {
            color: var(--bs-green);
        }

        .dropdown-item.active.selected {
            color: white !important;
        }
    </style>
</head>

<body class="bg-body-secondary">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-md mb-4">
        <div class="container">
            <a class="navbar-brand font-bold text-xl" href="#">Infitra Admin</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link text-lg hover:text-blue-600" href="company.html">Company
                            Information</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-lg hover:text-blue-600" href="system-control.html">System Control</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link text-lg hover:text-blue-600" href="subscription-creator.html">Subscription
                            Control</a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link text-lg hover:text-blue-600" href="system-maintenance.html">System
                            Maintenance</a>
                    </li>
                    <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-200 ease-in-out cursor-pointer" onclick="logout()">Logout</a>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-5">
        <h1 class="fs-2 fw-bold mb-5 text-center">Database Control Panel</h1>


        <!-- Update Database Form -->
        <div class="card mb-5">
            <div class="card-header">
                <h4 class="card-title">Upgrade System</h4>
            </div>
            <div class="card-body">
                <form id="updateForm">
                    <!-- <div class="mb-3">
                        <label for="updateClients" class="form-label">Clients</label>
                        <select id="updateClients" class="selectpicker form-control" multiple
                            data-live-search="true"></select>
                    </div>
                    <div class="mb-3">
                        <label for="updateModels" class="form-label">Models</label>
                        <select id="updateModels" class="selectpicker form-control" multiple
                            data-live-search="true"></select>
                        </button>
                    </div>
                    <div class="mb-3">
                        <label for="updateMigrations" class="form-label">Migrations</label>
                        <select id="updateMigrations" class="selectpicker form-control" multiple
                            data-live-search="true">
                        </select>
                    </div>
                    <div class="d-flex gap-4">
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="allModels">
                            <label class="form-check-label" for="allModels">All Models</label>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="FTJ">
                            <label class="form-check-label" for="FTJ">Functions/Triggers/Jobs</label>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="build">
                            <label class="form-check-label" for="build">Build Database</label>
                        </div>
                    </div> -->
                    <button type="submit" class="btn-loader btn btn-primary position-relative" id="updateSubmitBtn">
                        Update
                        <span class="spinner-border spinner-border-sm start-100" id="updateLoader"
                            style="display: none;" role="status" aria-hidden="true"></span>
                    </button>

                </form>
            </div>
        </div>

        <!-- Admin Sync -->
        <div class="card mb-5">
            <div class="card-header">
                <h4 class="card-title">Update Admin Database</h4>
            </div>
            <div class="card-body">
                <form id="updateAdminForm">
                    <div class="form-check d-none">
                        <input class="form-check-input" type="checkbox" id="resetCheckbox">
                        <label class="form-check-label" for="resetCheckbox">
                            Reset
                        </label>
                    </div>
                    <button type="submit" class="btn-loader btn btn-primary position-relative"
                        id="updateAdminSubmitBtn">
                        Update
                        <span class="spinner-border spinner-border-sm start-100" id="updateAdminLoader"
                            style="display: none;" role="status" aria-hidden="true"></span>
                    </button>

                </form>
            </div>
        </div>

        <!-- Reset Cache  -->
        <div class="card mb-5">
            <div class="card-header">
                <h4 class="card-title">Reset Cache</h4>
            </div>
            <div class="card-body">
                <form id="resetCacheForm">
                    <!-- <div class="form-check d-none">
                        <input class="form-check-input" type="checkbox" id="resetCheckbox">
                        <label class="form-check-label" for="resetCheckbox">
                            Reset
                        </label>
                    </div> -->
                    <button type="submit" class="btn-loader btn btn-primary position-relative" id="resetCacheBtn">
                        Reset Cache
                        <span class="spinner-border spinner-border-sm start-100" id="resetCacheLoader"
                            style="display: none;" role="status" aria-hidden="true"></span>
                    </button>

                </form>
            </div>
        </div>

        <!-- Reset Database Form -->
        <div class="card mb-5">
            <div class="card-header">
                <h4 class="card-title">Reset Database</h4>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="resetClient" class="form-label">Clients</label>
                    <select id="resetClient" class="selectpicker form-control" data-live-search="true"></select>
                </div>
                <button type="button" id="resetButton" class="btn btn-danger" data-bs-toggle="modal"
                    data-bs-target="#resetModal">Reset Database</button>
            </div>
        </div>

        <!-- Reset Resource -->
        <div class="card mb-5">
            <div class="card-header">
                <h4 class="card-title">Update Resources</h4>
            </div>
            <div class="card-body">
                <!-- <div class="mb-3">
                    <label for="resetClient" class="form-label">Clients</label>
                    <select id="resetClient" class="selectpicker form-control"></select>
                </div> -->
                <button type="button" id="updateResourceButton" class="btn btn-primary">
                    <span class="spinner-border spinner-border-sm start-100" id="updateResourceLoader"
                        style="display: none;" role="status" aria-hidden="true"></span>
                    Update Resources</button>
            </div>
        </div>

        <div class="card mb-5">
            <div class="card-header">
                <h4 class="card-title">Manage System Process</h4>
            </div>
            <div class="card-body">
                <form id="manageProcessForm">
                    <div class="mb-3">
                        <label for="processClient" class="form-label">Clients</label>
                        <select id="processClient" class="selectpicker form-control" data-live-search="true"></select>
                    </div>
                    <div class="mb-3">
                        <label for="processType" class="form-label">Process</label>
                        <select id="processType" class="selectpicker form-control" data-live-search="true">
                            <option value="nextAccruals">Next Accruals</option>
                            <option value="resetAccruals">Reset Accruals</option>
                            <option value="manageSalary">Manage Salary</option>
                            <option value="birthday">Birthday</option>
                            <option value="workAnniversary">Work Anniversary</option>
                            <option value="documentExpiry">Document Expiry</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="processDate" class="form-label">Date</label>
                        <input type="date" id="processDate" class="form-control">
                    </div>
                    <button type="submit" class="btn-loader btn btn-primary position-relative" id="processSubmitBtn">
                        Submit
                        <span class="spinner-border spinner-border-sm start-100" id="processLoader"
                            style="display: none;" role="status" aria-hidden="true"></span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Reset Confirmation Modal -->
        <div class="modal fade" id="resetModal" tabindex="-1" aria-labelledby="resetModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="resetModalLabel">Confirm Reset</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to reset the database? Please type <strong>reset</strong> below to
                            confirm.</p>
                        <input type="text" id="resetConfirmationInput" class="form-control">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

                        <button type="button" id="confirmResetButton"
                            class="btn-loader btn btn-danger  position-relative">
                            Confirm Reset
                            <span class="spinner-border spinner-border-sm start-100" id="resetLoader"
                                style="display: none;" role="status" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap-Select JS -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>

    <script src="/assets/script.js"></script>
    <script src="/assets/account-dropdown.js"></script>
    <script>
        // Toggle System User Form
        function toggleUserForm() {
            const systemUserSelected = document.getElementById('systemUser').checked;
            const customUserForm = document.getElementById('customUserForm');

            if (systemUserSelected) {
                customUserForm.style.display = 'none';
            } else {
                customUserForm.style.display = 'block';
                document.getElementById('workEmail').value = `prsuite${Math.floor(1000 + Math.random() * 9000).toString()}@kpi.co`
            }
        }

        // Enable Consultant Email Edit
        function enableConsultantEmailEdit() {
            var consultantEmail = document.getElementById('consultantEmail');
            consultantEmail.removeAttribute('readonly');
            consultantEmail.removeAttribute('disabled');
            consultantEmail.focus();
        }

        // Toggle Consultant Email Edit Based on Checkbox
        function toggleConsultantEmail() {
            var consultantAccess = document.getElementById('consultantAccess');
            var consultantEmailDiv = document.getElementById('consultantEmailDiv');
            var consultantAccessChecked = consultantAccess.checked;
            consultantEmailDiv.style.display = consultantAccessChecked ? 'flex' : 'none';
        }

        function toggleMultiSelect() {
            const checkbox = document.getElementById('employeeSettings');
            const multiSelectContainer = document.getElementById('multiSelectContainer');

            // Show or hide the multi-select dropdown based on checkbox state
            multiSelectContainer.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleUserCreationForm() {
            const checkbox = document.getElementById('userCreation');
            const userCreationForm = document.getElementById('userCreationForm');

            // Show or hide the multi-select dropdown based on checkbox state
            userCreationForm.style.display = checkbox.checked ? 'block' : 'none';
        }

        // Populate Client Data (for Seed and Update)
        function populateClients() {
            fetch(`${apiURL}/system/client/accounts`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${cognitoToken}`,
                    'x-origin-ip': originIP,
                    'x-otp': otp,
                    "x-compression": false,
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    const clientSelects = ['#seedClient', '#updateClients', '#resetClient', '#processClient'];
                    clientSelects.forEach(selectId => {
                        const select = document.querySelector(selectId);
                        select.innerHTML = ''; // Clear any existing options
                        data.data.forEach(account => {
                            const option = document.createElement('option');
                            option.value = account.accountId;
                            option.text = `${account.accountId} : ${account.name}`;
                            select.appendChild(option);
                        });
                        $(selectId).selectpicker('refresh'); // Refresh Bootstrap Select
                    });
                })
                .catch(error => console.error('Error fetching clients:', error));
        }

        // Populate Model Data
        // function populateModels() {
        //     fetch(`${apiURL}/system/client/models`, {
        //         method: 'GET',
        //         headers: {
        //             'Authorization': `Bearer ${cognitoToken}`,

        //             'x-origin-ip': originIP,
        //             'x-otp': otp,
        //             "x-compression": false,
        //             'Content-Type': 'application/json'
        //         }
        //     })
        //         .then(response => response.json())
        //         .then(data => {
        //             const select = document.querySelector('#updateModels');
        //             select.innerHTML = ''; // Clear any existing options
        //             data.data.forEach((model, index) => {
        //                 const option = document.createElement('option');
        //                 option.value = model?.id;
        //                 option.text = `${index + 1}. ${model?.name}`;
        //                 select.appendChild(option);
        //             });
        //             $('#updateModels').selectpicker('refresh'); // Refresh Bootstrap Select
        //         })
        //         .catch(error => console.error('Error fetching models:', error));
        // }

        // function fetchMigrationFiles() {
        //     fetch(`${apiURL}/system/migrations`, {
        //         method: 'GET',
        //         headers: {
        //             'Authorization': `Bearer ${cognitoToken}`,
        //             'x-origin-ip': originIP,
        //             'x-otp': otp,
        //             "x-compression": false,
        //             'Content-Type': 'application/json'
        //         }
        //     })
        //         .then(response => response.json())
        //         .then(data => {
        //             const select = document.querySelector('#updateMigrations');
        //             select.innerHTML = ''; // Clear any existing options
        //             data.data.forEach(model => {
        //                 const option = document.createElement('option');
        //                 option.value = model?.fileName;
        //                 option.text = model?.name;
        //                 select.appendChild(option);
        //             });
        //             $('#updateMigrations').selectpicker('refresh'); // Refresh Bootstrap Select
        //         })
        //         .catch(error => console.error('Error fetching models:', error));
        // }

        // Seed Database
        // document.getElementById('seedForm').addEventListener('submit', function (e) {
        //     e.preventDefault();
        //     const seedButton = document.getElementById('seedSubmitBtn');
        //     const seedLoader = document.getElementById('seedLoader');
        //     // Show loader and disable button
        //     seedLoader.style.display = 'inline-block';
        //     seedButton.disabled = true;

        //     const client = $('#seedClient').val();
        //     const recordNames = $('#recordNames').val();
        //     const standardRoles = document.getElementById('standardRoles').checked;
        //     const systemUser = document.getElementById('systemUser').checked;
        //     const customUser = document.getElementById('customUser').checked;
        //     const consultantAccess = document.getElementById('consultantAccess').checked;
        //     const employeeSettings = document.getElementById('employeeSettings').checked;
        //     const leaveSettings = document.getElementById('leaveSettings').checked;

        //     let customUserData = {};
        //     if (customUser) {
        //         customUserData = {
        //             workEmail: document.getElementById('workEmail').value,
        //             firstName: document.getElementById('firstName').value,
        //             lastName: document.getElementById('lastName').value,
        //         };
        //     }
        //     let consultantUserData = {};
        //     if (consultantAccess) {
        //         consultantUserData = {
        //             workEmail: document.getElementById('consultantEmail').value,
        //             firstName: 'Infithra',
        //             lastName: 'Consultant'
        //         };
        //     }

        //     const body = {
        //         customUser: customUserData,
        //         consultantUser: consultantUserData,
        //         recordNames,
        //         seed: [
        //             standardRoles && 'standardRoles',
        //             customUser && 'customUser',
        //             systemUser && 'systemUser',
        //             employeeSettings && 'employeeSettings',
        //             leaveSettings && 'leaveSettings',
        //             consultantAccess && 'consultantAccess'
        //         ].filter(Boolean)
        //     };


        //     console.log('Seeding database with:', body);
        //     // Send API request here
        //     fetch(`${apiURL}/system/seed`, {
        //         method: 'PUT',
        //         headers: {
        //             'Content-Type': 'application/json',
        //             'client': client,
        //             'Authorization': `Bearer ${cognitoToken}`,

        //             'x-otp': otp,
        //             "x-compression": false,
        //             'x-origin-ip': originIP
        //         },
        //         body: JSON.stringify(body)
        //     }).then(response => {
        //         if (!response.ok) {
        //             throw new Error('Network response was not ok ' + response.statusText);
        //         }
        //         return response.json();
        //     }).then(data => {
        //         console.log('Success:', data);
        //         alert("Seed Successful!")
        //     }).catch((error) => {
        //         console.error('Error:', error);
        //     }).finally(() => {
        //         seedLoader.style.display = 'none';
        //         seedButton.disabled = false;
        //     });
        // });

        // Update Database
        // Update Database
        document.getElementById('updateForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const updateButton = document.getElementById('updateSubmitBtn');
            const updateLoader = document.getElementById('updateLoader');
            updateLoader.style.display = 'inline-block';
            updateButton.disabled = true;

            // const clients = $('#updateClients').val();
            // const ftj = document.getElementById('FTJ').checked;
            // const build = document.getElementById('build').checked;
            // const allModels = document.getElementById('allModels').checked;
            // const migrations = $('#updateMigrations').val();
            // let models = $('#updateModels').val();

            function chunkArray(array, size) {
                const result = [];
                for (let i = 0; i < array.length; i += size) {
                    result.push(array.slice(i, i + size));
                }
                return result;
            }

            async function sendUpdate(body = {}) {
                return fetch(`${apiURL}/system/upgrade`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${cognitoToken}`,
                        'x-compression': false,
                        'x-origin-ip': originIP
                    },
                    body: JSON.stringify(body)
                }).then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                });
            }

            // async function sendUpdateWithRetry(body) {
            //     while (true) {
            //         try {
            //             const response = await sendUpdate(body);
            //             // If sendUpdate returns a response object, check for Unauthorized
            //             if (response && response.message === 'Unauthorized Access') {
            //                 throw new Error('Unauthorized Access');
            //             }
            //             return response; // Success, exit loop
            //         } catch (error) {
            //             if (error.message === 'Unauthorized Access') {
            //                 throw error; // Stop on unauthorized
            //             }
            //             if (error.message.includes('Gateway Timeout') || error.message.includes('504')) {
            //                 // Retry on gateway timeout
            //                 console.warn('Gateway Timeout, retrying chunk...');
            //                 continue;
            //             }
            //             throw error; // Stop on other errors
            //         }
            //     }
            // }

            try {
                // if (allModels) {
                    // Get all model IDs from the select options
                    // const allModelOptions = Array.from(document.querySelectorAll('#updateModels option'));
                    // const allModelIds = allModelOptions.map(opt => opt.value);
                    // Calculate number of chunks
                //     const chunks = chunkArray(allModelIds, 200);
                //     const chunkCount = chunks.length;
                //     const totalChunks = chunkCount + (build ? 1 : 0);
                //     // Send chunked model API calls
                //     for (let i = 0; i < chunks.length; i++) {
                //         const body = {
                //             clients,
                //             models: chunks[i],
                //             build: false,
                //             FTJ: ftj,
                //             migrations,
                //             chunkNumber: i + 1,
                //             totalChunks
                //         };
                //         await sendUpdateWithRetry(body);
                //     }
                //     let nextChunk = chunkCount + 1;
                //     if (build) {
                //         const body = {
                //             clients,
                //             models: [],
                //             build: true,
                //             FTJ: ftj,
                //             migrations,
                //             chunkNumber: nextChunk,
                //             totalChunks
                //         };
                //         await sendUpdateWithRetry(body);
                //     }
                // } else {
                    // Not all models selected, use selected models in one call
                // }
                await sendUpdate();
                alert("Update Successful!");
            } catch (error) {
                console.error('Error:', error);
                alert('Update failed: ' + error.message);
            } finally {
                updateLoader.style.display = 'none';
                updateButton.disabled = false;
            }
        });

        // Update Admin Database
        document.getElementById('updateAdminForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const updateButton = document.getElementById('updateAdminSubmitBtn');
            const updateLoader = document.getElementById('updateAdminLoader');
            const resetChecked = document.getElementById('resetCheckbox').checked; // Check if the reset checkbox is checked

            // Show loader and disable button
            updateLoader.style.display = 'inline-block';
            updateButton.disabled = true;

            const body = {
                reset: resetChecked
            };

            fetch(`${apiURL}/system/admin`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${cognitoToken}`,
                    'x-otp': otp,
                    "x-compression": false,
                    'x-origin-ip': originIP
                },
                body: JSON.stringify(body) // Send the body with reset value
            }).then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            }).catch((error) => {
                console.error('Error:', error);
            }).finally(() => {
                alert("Update Successful!");
                updateLoader.style.display = 'none';
                updateButton.disabled = false;
            });
        });

        // Update Resources
        document.getElementById('updateResourceButton').addEventListener('click', function (e) {
            e.preventDefault();
            const updateButton = document.getElementById('updateResourceButton');
            const updateLoader = document.getElementById('updateResourceLoader');

            // Show loader and disable button
            updateLoader.style.display = 'inline-block';
            updateButton.disabled = true;


            fetch(`${apiURL}/core-hr/ch/resources/update`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${cognitoToken}`,
                    'x-otp': otp,
                    "x-compression": false,
                    'x-origin-ip': originIP
                }
            }).then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            }).catch((error) => {
                console.error('Error:', error);
            }).finally(() => {
                alert("Update Resource Successful!");
                updateLoader.style.display = 'none';
                updateButton.disabled = false;
            });
        });

        document.getElementById('resetCacheForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const resetCacheButton = document.getElementById('resetCacheBtn');
            const resetCacheLoader = document.getElementById('resetCacheLoader');

            // Show loader and disable button
            resetCacheLoader.style.display = 'inline-block';
            resetCacheButton.disabled = true;

            fetch(`${apiURL}/system/cache/clear`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${cognitoToken}`,
                    'x-otp': otp,
                    "x-compression": false,
                    'x-origin-ip': originIP
                }
            }).then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            }).catch((error) => {
                console.error('Error:', error);
            }).finally(() => {
                alert("Update Successful!");
                resetCacheLoader.style.display = 'none';
                resetCacheButton.disabled = false;
            });
        });

        // Reset confirmation logic
        document.getElementById('confirmResetButton').addEventListener('click', function () {

            const confirmButton = document.getElementById('confirmResetButton');
            const confirmButtonLoader = document.getElementById('resetLoader');
            const input = document.getElementById('resetConfirmationInput');
            console.log("ðŸš€ ~ input.value:", input.value)

            if (input.value.toLowerCase() === 'reset') {

                confirmButton.disabled = true;
                confirmButtonLoader.style.display = 'inline-block'

                const client = $('#resetClient').val();

                fetch(`${apiURL}/system/reset/${client}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${cognitoToken}`,
                        "x-compression": false,
                        'x-origin-ip': originIP
                    }
                }).then(response => {
                    if (!response.ok) {
                        alert("Reset Unsuccessful!");
                        throw new Error('Network response was not ok');
                    }
                    alert("Reset Successful!");
                    confirmButton.disabled = false;
                    confirmButtonLoader.style.display = 'none';
                    return response.json();
                })
                    .catch(error => {
                        console.error('Error:', error);
                        confirmButtonLoader.style.display = 'none';
                        confirmButton.disabled = false;
                    })
            }

        });

        document.getElementById('manageProcessForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const client = $('#processClient').val();
            const process = document.getElementById('processType').value;
            const date = new Date(document.getElementById('processDate').value).toISOString().split('T')[0];

            if (!client || !process || !date) {
                alert('Please fill out all fields.');
                return;
            }

            const body = {
                process,
                date
            };

            document.getElementById('processLoader').style.display = 'inline-block';

            try {
                const response = await fetch(`${apiURL}/system/process`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${cognitoToken}`,
                        'x-origin-ip': originIP,
                        'x-otp': otp,
                        "x-compression": false,
                        'client': client,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                const result = await response.json();
                document.getElementById('processLoader').style.display = 'none';

                if (response.ok) {
                    alert('Process submitted successfully!');
                } else {
                    alert(`Error: ${result.message || 'Failed to submit the process'}`);
                }
            } catch (error) {
                document.getElementById('processLoader').style.display = 'none';
                alert(`Error: ${error.message || 'Network error'}`);
            }
        });
    </script>
</body>

</html>